"use client";
import { useGlobalContext } from "@/context/globalContext";
import { signIn } from "next-auth/react";
import React, { useState, ChangeEvent, MouseEvent, useEffect } from "react";
import Loading from "./loading";
import ToastFail from "./toastFail";

type FormData = {
    email: string;
    password: string;
}

export default function LoginForm() {
  const [formData, setFormData] = useState<FormData>({
    email: "",
    password: "",
  });
  const [showPass, setShowPass] = useState(false);
  const [error, setError] = useState(false);
  const { setLoading, loading } = useGlobalContext();
  const [toast, setToast] = useState<{
    type: "success" | "fail";
    message: string;
  } | null>(null);

  function handleInput(e: ChangeEvent<HTMLInputElement>) {
    setError(false);
    const { name, value } = e.target;
    setFormData((prevData) => {
      const newData = {
        ...prevData,
        [name]: value,
      };
      return newData;
    });
  }

    function controlPass(e: MouseEvent<SVGSVGElement>) {
        e.preventDefault();
        setShowPass(!showPass);
    } 

    async function handleSubmit(e: React.FormEvent) {
    e.preventDefault();
      setLoading(true);
      setError(false);
    const res = await signIn('credentials', {
      redirect: false,
      email: formData.email,
      password: formData.password,
    });

    if (res?.ok) {
      setLoading(false);
      window.location.href = '/dashboard';
    } else {
      setLoading(false);
      setError(true);
      setToast({ type: 'fail', message: 'Login failed, make sure of your credentials' });
    }
  };

  useEffect(() => {
    if (toast) (
      setTimeout(() => {
        setToast(null);
      }, 3000)
    );

  }, [toast]);

  // absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2
  return (
    <div className="w-[100%] md:w-[50%] lg:w-[30%] bg-white dark:bg-teal-500 py-4 rounded-lg shadow-lg mx-auto">
      <h1 className="text-blue-500 dark:text-teal-200 font-bold text-[20px] flex flex-row justify-center">
        Login to your account
      </h1>
      {
        toast && (
          <ToastFail failMessage={toast.message} />
        )
      }
      <form className="flex flex-col justify-center items-center" onSubmit={handleSubmit}>
        <div className="flex flex-col items-start mt-4">
          <label className="font-thin" htmlFor="email">
            Email
          </label>
          <input
            className="px-2 py-1 bg-transparent border border-blue-500 dark:border-yellow-600 rounded-lg text-black dark:text-teal-200 stroke-none outline-none"
            type="email"
            name="email"
            placeholder="Enter your email"
            required
            value={formData.email}
            onChange={(e) => handleInput(e)}
          />
        </div>

        <div className="flex flex-col items-start mt-4">
          <label className="font-thin" htmlFor="password">
            Password
          </label>
          <div className="flex flex-row justify-between items-center border border-blue-500 dark:border-yellow-600 px-2 py-1 rounded-lg">
            <input
              className=" bg-transparent text-black dark:text-teal-200 stroke-none outline-none"
              type={!showPass ? 'password' : 'text'}
              name="password"
              placeholder="Enter your password"
              value={formData.password}
              onChange={(e) => handleInput(e)}
              required
            />
            {!showPass && (
              <svg
              className="hover:cursor-pointer"
                width="28"
                height="20"
                viewBox="0 0 28 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                onClick={controlPass}
              >
                <path
                  d="M19 10C19 11.3261 18.4732 12.5979 17.5355 13.5355C16.5979 14.4732 15.3261 15 14 15M9 10C9 8.67392 9.52678 7.40215 10.4645 6.46447C11.4021 5.52678 12.6739 5 14 5M11 18.654C11.9837 18.8822 12.9901 18.9982 14 19C21.18 19 27 13 27 10C27 8.664 25.845 6.732 23.929 5M17.5 1.47C16.359 1.16065 15.1822 1.00262 14 1C6.82 1 1 7 1 10C1 11.32 2.127 13.22 4 14.935M5 19L23 1"
                  stroke="#3B82F6"
                  strokeLinecap="round"
                  strokeLinejoin="round"
                />
              </svg>
            )}
            {showPass && (
              <svg
                className="hover:cursor-pointer"
                onClick={controlPass}
                width="26"
                height="18"
                viewBox="0 0 26 18"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <mask id="path-1-inside-1_101_5" fill="white">
                  <path d="M25.9253 8.6355C25.8873 8.54663 24.9698 6.43275 22.9298 4.31437C20.2118 1.49175 16.7787 0 13 0C9.22133 0 5.78824 1.49175 3.07016 4.31437C1.03024 6.43275 0.108323 8.55 0.0747397 8.6355C0.0254622 8.7506 0 8.87516 0 9.00112C0 9.12709 0.0254622 9.25165 0.0747397 9.36675C0.112656 9.45562 1.03024 11.5684 3.07016 13.6868C5.78824 16.5082 9.22133 18 13 18C16.7787 18 20.2118 16.5082 22.9298 13.6868C24.9698 11.5684 25.8873 9.45562 25.9253 9.36675C25.9745 9.25165 26 9.12709 26 9.00112C26 8.87516 25.9745 8.7506 25.9253 8.6355ZM13 16.2C9.6655 16.2 6.75241 14.9411 4.34091 12.4594C3.35148 11.4375 2.50967 10.2723 1.84166 9C2.50941 7.72753 3.35125 6.56229 4.34091 5.54062C6.75241 3.05887 9.6655 1.8 13 1.8C16.3345 1.8 19.2476 3.05887 21.6591 5.54062C22.6504 6.56212 23.4941 7.72734 24.1638 9C23.3827 10.5142 19.9799 16.2 13 16.2ZM13 3.6C11.9715 3.6 10.9662 3.9167 10.111 4.51006C9.2559 5.10342 8.5894 5.94679 8.19582 6.93351C7.80225 7.92023 7.69927 9.00599 7.89991 10.0535C8.10056 11.101 8.59581 12.0632 9.32304 12.8184C10.0503 13.5736 10.9768 14.0879 11.9855 14.2962C12.9942 14.5046 14.0398 14.3977 14.99 13.9889C15.9401 13.5802 16.7523 12.8881 17.3236 12.0001C17.895 11.1121 18.2 10.068 18.2 9C18.1986 7.56829 17.6503 6.19564 16.6754 5.18327C15.7005 4.17089 14.3787 3.60149 13 3.6ZM13 12.6C12.3144 12.6 11.6441 12.3889 11.074 11.9933C10.5039 11.5977 10.0596 11.0355 9.79721 10.3777C9.53483 9.71985 9.46618 8.99601 9.59994 8.29767C9.7337 7.59934 10.0639 6.95788 10.5487 6.45442C11.0335 5.95095 11.6512 5.60808 12.3237 5.46917C12.9962 5.33027 13.6932 5.40156 14.3266 5.67403C14.9601 5.94651 15.5015 6.40793 15.8824 6.99995C16.2634 7.59196 16.4667 8.28799 16.4667 9C16.4667 9.95478 16.1014 10.8705 15.4513 11.5456C14.8012 12.2207 13.9194 12.6 13 12.6Z" />
                </mask>
                <path
                  d="M25.9253 8.6355C25.8873 8.54663 24.9698 6.43275 22.9298 4.31437C20.2118 1.49175 16.7787 0 13 0C9.22133 0 5.78824 1.49175 3.07016 4.31437C1.03024 6.43275 0.108323 8.55 0.0747397 8.6355C0.0254622 8.7506 0 8.87516 0 9.00112C0 9.12709 0.0254622 9.25165 0.0747397 9.36675C0.112656 9.45562 1.03024 11.5684 3.07016 13.6868C5.78824 16.5082 9.22133 18 13 18C16.7787 18 20.2118 16.5082 22.9298 13.6868C24.9698 11.5684 25.8873 9.45562 25.9253 9.36675C25.9745 9.25165 26 9.12709 26 9.00112C26 8.87516 25.9745 8.7506 25.9253 8.6355ZM13 16.2C9.6655 16.2 6.75241 14.9411 4.34091 12.4594C3.35148 11.4375 2.50967 10.2723 1.84166 9C2.50941 7.72753 3.35125 6.56229 4.34091 5.54062C6.75241 3.05887 9.6655 1.8 13 1.8C16.3345 1.8 19.2476 3.05887 21.6591 5.54062C22.6504 6.56212 23.4941 7.72734 24.1638 9C23.3827 10.5142 19.9799 16.2 13 16.2ZM13 3.6C11.9715 3.6 10.9662 3.9167 10.111 4.51006C9.2559 5.10342 8.5894 5.94679 8.19582 6.93351C7.80225 7.92023 7.69927 9.00599 7.89991 10.0535C8.10056 11.101 8.59581 12.0632 9.32304 12.8184C10.0503 13.5736 10.9768 14.0879 11.9855 14.2962C12.9942 14.5046 14.0398 14.3977 14.99 13.9889C15.9401 13.5802 16.7523 12.8881 17.3236 12.0001C17.895 11.1121 18.2 10.068 18.2 9C18.1986 7.56829 17.6503 6.19564 16.6754 5.18327C15.7005 4.17089 14.3787 3.60149 13 3.6ZM13 12.6C12.3144 12.6 11.6441 12.3889 11.074 11.9933C10.5039 11.5977 10.0596 11.0355 9.79721 10.3777C9.53483 9.71985 9.46618 8.99601 9.59994 8.29767C9.7337 7.59934 10.0639 6.95788 10.5487 6.45442C11.0335 5.95095 11.6512 5.60808 12.3237 5.46917C12.9962 5.33027 13.6932 5.40156 14.3266 5.67403C14.9601 5.94651 15.5015 6.40793 15.8824 6.99995C16.2634 7.59196 16.4667 8.28799 16.4667 9C16.4667 9.95478 16.1014 10.8705 15.4513 11.5456C14.8012 12.2207 13.9194 12.6 13 12.6Z"
                  fill="#3B82F6"
                />
                <path
                  d="M25.9253 8.6355L25.0055 9.02791L25.006 9.02907L25.9253 8.6355ZM0.0747397 8.6355L0.994033 9.02907L0.999985 9.01517L1.00551 9.0011L0.0747397 8.6355ZM0.0747397 9.36675L0.994531 8.97434L0.994033 8.97318L0.0747397 9.36675ZM3.07016 13.6868L2.34984 14.3804L2.34998 14.3805L3.07016 13.6868ZM22.9298 13.6868L23.65 14.3805L23.6502 14.3804L22.9298 13.6868ZM25.9253 9.36675L25.006 8.97318L25.0055 8.97434L25.9253 9.36675ZM26 9.00112L27 9.00112L26 9.00112ZM4.34091 12.4594L3.62249 13.155L3.62373 13.1563L4.34091 12.4594ZM1.84166 9L0.956176 8.53533L0.712266 9.00012L0.956275 9.46486L1.84166 9ZM4.34091 5.54062L3.62372 4.84374L3.62264 4.84486L4.34091 5.54062ZM21.6591 5.54062L22.3767 4.84419L22.3763 4.84374L21.6591 5.54062ZM24.1638 9L25.0525 9.45843L25.2913 8.9954L25.0487 8.53433L24.1638 9ZM13 3.6L13.0011 2.6H13V3.6ZM18.2 9L19.2 9L19.2 8.999L18.2 9ZM15.8824 6.99995L16.7234 6.45885L15.8824 6.99995ZM26.8451 8.24309C26.7821 8.09563 25.8067 5.86026 23.6502 3.62073L22.2095 5.00802C23.1676 6.00294 23.8638 6.9989 24.3239 7.75556C24.5534 8.13311 24.7229 8.44881 24.8356 8.67187C24.892 8.78333 24.9341 8.87142 24.9623 8.93227C24.9764 8.96269 24.9871 8.98626 24.9943 9.00249C24.9979 9.01061 25.0007 9.01686 25.0026 9.02119C25.0035 9.02335 25.0042 9.02501 25.0047 9.02617C25.0052 9.02734 25.0055 9.02792 25.0055 9.02791L26.8451 8.24309ZM23.6502 3.62073C20.7514 0.61052 17.0616 -1 13 -1V1C16.4958 1 19.6721 2.37298 22.2095 5.00802L23.6502 3.62073ZM13 -1C8.93844 -1 5.24856 0.61052 2.34984 3.62073L3.79048 5.00802C6.32792 2.37298 9.50422 1 13 1V-1ZM2.34984 3.62073C0.197834 5.85551 -0.787032 8.09423 -0.856034 8.2699L1.00551 9.0011C1.00368 9.00577 1.86265 7.00999 3.79048 5.00802L2.34984 3.62073ZM-0.844554 8.24193C-0.947412 8.48218 -1 8.7407 -1 9.00112H1C1 9.00962 0.998337 9.01902 0.994033 9.02907L-0.844554 8.24193ZM-1 9.00112C-1 9.26154 -0.947413 9.52007 -0.844554 9.76032L0.994033 8.97318C0.998337 8.98323 1 8.99263 1 9.00112H-1ZM-0.845051 9.75916C-0.782039 9.90685 0.19337 12.141 2.34984 14.3804L3.79048 12.9931C2.83235 11.9981 2.13616 11.0024 1.67605 10.246C1.44647 9.86857 1.27703 9.553 1.16428 9.33005C1.10794 9.21864 1.06587 9.13059 1.03762 9.06978C1.0235 9.03937 1.01286 9.01582 1.00563 8.99961C1.00202 8.9915 0.999278 8.98526 0.997395 8.98095C0.996455 8.9788 0.995739 8.97715 0.995247 8.97601C0.994747 8.97485 0.994511 8.97429 0.99453 8.97434L-0.845051 9.75916ZM2.34998 14.3805C5.24866 17.3895 8.93847 19 13 19V17C9.50419 17 6.32783 15.627 3.79034 12.993L2.34998 14.3805ZM13 19C17.0615 19 20.7513 17.3895 23.65 14.3805L22.2097 12.993C19.6722 15.627 16.4958 17 13 17V19ZM23.6502 14.3804C25.8066 12.141 26.782 9.90685 26.8451 9.75916L25.0055 8.97434C25.0055 8.97429 25.0053 8.97485 25.0048 8.97601C25.0043 8.97715 25.0035 8.9788 25.0026 8.98095C25.0007 8.98526 24.998 8.9915 24.9944 8.99961C24.9871 9.01582 24.9765 9.03937 24.9624 9.06978C24.9341 9.13059 24.8921 9.21864 24.8357 9.33005C24.723 9.553 24.5535 9.86857 24.324 10.246C23.8638 11.0024 23.1676 11.9981 22.2095 12.9931L23.6502 14.3804ZM26.8446 9.76032C26.9474 9.52007 27 9.26155 27 9.00112L25 9.00112C25 8.99263 25.0017 8.98323 25.006 8.97318L26.8446 9.76032ZM27 9.00112C27 8.7407 26.9474 8.48218 26.8446 8.24193L25.006 9.02907C25.0017 9.01902 25 9.00962 25 9.00112L27 9.00112ZM13 15.2C9.94706 15.2 7.28938 14.0588 5.05809 11.7625L3.62373 13.1563C6.21545 15.8235 9.38393 17.2 13 17.2V15.2ZM5.05933 11.7638C4.13696 10.8112 3.35115 9.72382 2.72704 8.53514L0.956275 9.46486C1.66818 10.8208 2.56599 12.0638 3.62249 13.155L5.05933 11.7638ZM2.72714 9.46467C3.35095 8.27595 4.1367 7.1887 5.05918 6.23639L3.62264 4.84486C2.56579 5.93588 1.66787 7.17911 0.956176 8.53533L2.72714 9.46467ZM5.05809 6.23751C7.28938 3.94123 9.94706 2.8 13 2.8V0.8C9.38393 0.8 6.21545 2.17652 3.62373 4.84374L5.05809 6.23751ZM13 2.8C16.0529 2.8 18.7106 3.94123 20.9419 6.23751L22.3763 4.84374C19.7846 2.17652 16.6161 0.8 13 0.8V2.8ZM20.9415 6.23706C21.8656 7.18931 22.6531 8.27665 23.2788 9.46567L25.0487 8.53433C24.335 7.17804 23.4353 5.93493 22.3767 4.84419L20.9415 6.23706ZM23.275 8.54157C22.5212 10.0031 19.3708 15.2 13 15.2V17.2C20.589 17.2 24.2442 11.0254 25.0525 9.45843L23.275 8.54157ZM13 2.6C11.7652 2.6 10.5613 2.98045 9.54095 3.68848L10.6811 5.33165C11.371 4.85296 12.1779 4.6 13 4.6V2.6ZM9.54095 3.68848C8.52105 4.39616 7.73169 5.39798 7.26698 6.56302L9.12466 7.304C9.44711 6.4956 9.99074 5.81069 10.6811 5.33165L9.54095 3.68848ZM7.26698 6.56302C6.80239 7.72779 6.68137 9.00743 6.91777 10.2416L8.88206 9.86536C8.71717 9.00455 8.8021 8.11267 9.12466 7.304L7.26698 6.56302ZM6.91777 10.2416C7.1542 11.4759 7.73864 12.6147 8.60272 13.512L10.0434 12.1247C9.45298 11.5116 9.04692 10.726 8.88206 9.86536L6.91777 10.2416ZM8.60272 13.512C9.4672 14.4097 10.5733 15.0256 11.7832 15.2756L12.1878 13.3169C11.3804 13.1501 10.6334 12.7374 10.0434 12.1247L8.60272 13.512ZM11.7832 15.2756C12.9935 15.5256 14.2476 15.3969 15.3851 14.9076L14.5948 13.0703C13.832 13.3984 12.995 13.4836 12.1878 13.3169L11.7832 15.2756ZM15.3851 14.9076C16.5222 14.4185 17.4879 13.5929 18.1646 12.5412L16.4827 11.459C16.0166 12.1833 15.3581 12.742 14.5948 13.0703L15.3851 14.9076ZM18.1646 12.5412C18.8411 11.4898 19.2 10.2576 19.2 9L17.2 9C17.2 9.87845 16.949 10.7343 16.4827 11.459L18.1646 12.5412ZM19.2 8.999C19.1983 7.31433 18.5535 5.69193 17.3957 4.48963L15.9551 5.87691C16.747 6.69936 17.1988 7.82225 17.2 9.001L19.2 8.999ZM17.3957 4.48963C16.2367 3.28605 14.657 2.60179 13.0011 2.6L12.9989 4.6C14.1003 4.60119 15.1643 5.05574 15.9551 5.87691L17.3957 4.48963ZM13 11.6C12.5207 11.6 12.0489 11.4526 11.6441 11.1717L10.5039 12.8149C11.2393 13.3251 12.108 13.6 13 13.6V11.6ZM11.6441 11.1717C11.2388 10.8905 10.9173 10.4867 10.7261 10.0072L8.86838 10.7481C9.20189 11.5843 9.76909 12.305 10.5039 12.8149L11.6441 11.1717ZM10.7261 10.0072C10.5347 9.52741 10.4841 8.99745 10.5821 8.4858L8.6178 8.10955C8.44828 8.99457 8.53498 9.91229 8.86838 10.7481L10.7261 10.0072ZM10.5821 8.4858C10.6801 7.97429 10.921 7.50941 11.269 7.14806L9.82837 5.76077C9.2067 6.40636 8.78734 7.22439 8.6178 8.10955L10.5821 8.4858ZM11.269 7.14806C11.6166 6.78711 12.0548 6.54583 12.526 6.4485L12.1214 4.48985C11.2477 4.67033 10.4504 5.11478 9.82837 5.76077L11.269 7.14806ZM12.526 6.4485C12.9969 6.35123 13.4854 6.40077 13.9315 6.59265L14.7218 4.75541C13.901 4.40234 12.9954 4.3093 12.1214 4.48985L12.526 6.4485ZM13.9315 6.59265C14.3781 6.78474 14.7659 7.11272 15.0415 7.54105L16.7234 6.45885C16.2371 5.70314 15.5421 5.10828 14.7218 4.75541L13.9315 6.59265ZM15.0415 7.54105C15.3173 7.96975 15.4667 8.47755 15.4667 9H17.4667C17.4667 8.09842 17.2094 7.21418 16.7234 6.45885L15.0415 7.54105ZM15.4667 9C15.4667 9.70148 15.198 10.367 14.731 10.8519L16.1716 12.2392C17.0049 11.3739 17.4667 10.2081 17.4667 9H15.4667ZM14.731 10.8519C14.2652 11.3356 13.6418 11.6 13 11.6V13.6C14.1971 13.6 15.3371 13.1058 16.1716 12.2392L14.731 10.8519Z"
                  fill="#3B82F6"
                  mask="url(#path-1-inside-1_101_5)"
                />
              </svg>
            )}
          </div>
        </div>
        {error && (<p className="text-red-500 text-[14px] font-normal">Incorrect credentials</p>)}
        <button className="bg-blue-500 dark:bg-violet-500 px-12 py-2 rounded-full text-white font-semibold mt-12 animate-pulse" disabled={ loading }>
          <Loading text="Login"/>
        </button>
      </form>
      <p className="px-2 text-red-500 dark:text-teal-200 font-medium">Login Instructions*</p>
      <p className="px-2 text-green-500 dark:text-teal-200 font-normal text-[14px]">{`- To login as admin use: ali@gmail.com, 123 =>  admin Dashboard`}</p>
      <p className="px-2 text-yellow-500 dark:text-teal-200 font-normal text-[14px]">{`- To login as editor use: usama@gmail.com, 123 => editor Dashboard`}</p>
      <p className="px-2 text-violet-500 dark:text-teal-200 font-normal text-[14px]">{`- To login as viewer use: asad@gmail.com, 123 => home page`}</p>
      <p className="px-2 text-red-500 dark:text-teal-200 font-normal text-[14px]">To use Filtering and searching on homePage, you have to login (part of optional Tasks)</p>
    </div>
  );
}
